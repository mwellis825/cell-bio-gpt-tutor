name: Vendor H5P runtime into docs

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  vendor:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Ensure docs directory
        run: mkdir -p docs

      - name: Download h5p-standalone dist (GitHub raw, tag 1.3.1)
        run: |
          set -euo pipefail
          TAG="1.3.0"
          echo "Fetching h5p-standalone @ ${TAG} â€¦"
          curl -fsSL "https://raw.githubusercontent.com/tunapanda/h5p-standalone/${TAG}/dist/main.bundle.js"  -o docs/main.bundle.js
          curl -fsSL "https://raw.githubusercontent.com/tunapanda/h5p-standalone/${TAG}/dist/frame.bundle.js" -o docs/frame.bundle.js
          curl -fsSL "https://raw.githubusercontent.com/tunapanda/h5p-standalone/${TAG}/dist/styles/h5p.css" -o docs/h5p.css
          echo "Downloaded files:"
          ls -lh docs

      - name: Commit files to main
        run: |
          set -e
          git config user.name  "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add docs/main.bundle.js docs/frame.bundle.js docs/h5p.css
          if git diff --cached --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Vendor h5p-standalone dist (1.3.1) into docs"
            git push origin main
          fi
