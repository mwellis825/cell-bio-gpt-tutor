<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' data:; style-src 'self' 'unsafe-inline' data:; img-src 'self' data: blob:; connect-src 'self' data: blob:;">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./h5p.css" />
  <style>
    html, body { height: 100%; margin:0; }
    #app { min-height: 100vh; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script src="./main.bundle.js"></script>
  <script src="./frame.bundle.js"></script>

  <script>
    // Expect a base64 H5P passed via URL fragment: #b64=<base64-zip>
    function getB64() {
      try {
        const m = location.hash.match(/b64=([^&]+)/);
        return m ? decodeURIComponent(m[1]) : null;
      } catch (e) { return null; }
    }
    function boot() {
      var tries = 0, b64 = getB64();
      if (!b64) {
        document.getElementById('app').innerHTML =
          '<p style="color:#b00">No H5P payload. Append #b64=&lt;base64&gt; to the URL.</p>';
        return;
      }
      (function wait() {
        tries++;
        if (window.H5PStandalone && typeof window.H5PStandalone.display === 'function') {
          try {
            window.H5PStandalone.display('#app', { h5pContent: 'data:application/zip;base64,' + b64 });
          } catch (e) {
            document.getElementById('app').innerHTML =
              '<p style="color:#b00">Could not initialize H5P: ' + (e && e.message ? e.message : e) + '</p>';
          }
        } else if (tries < 240) {
          setTimeout(wait, 50);
        } else {
          document.getElementById('app').innerHTML =
            '<p style="color:#b00">H5P API not ready.</p>';
        }
      })();
    }
    boot();
  </script>
</body>
</html>
