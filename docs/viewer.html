<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>H5P Viewer (CDN test)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}#app{min-height:100vh}.err{color:#b00;padding:1rem}.hint{padding:.75rem 1rem;background:#f6f8fa;border:1px solid #e5e7eb;border-radius:.5rem;margin:1rem}</style>
  <script>
    // Log any runtime errors so we can see them
    window.addEventListener('error', e => console.error('Window error:', e.error || e.message || e));
    function qp(n){ const u=new URL(location.href); return u.searchParams.get(n); }
    function loadScript(src){
      return new Promise((resolve,reject)=>{
        const s=document.createElement('script');
        s.src=src; s.onload=()=>{ console.log('Loaded',src); resolve(); };
        s.onerror=()=>reject(new Error('Failed to load: '+src));
        document.head.appendChild(s);
      });
    }
    async function boot(){
      const app=document.getElementById('app');
      const src=qp('src');
      if(!src){ app.innerHTML='<div class="hint">No H5P source. Use <code>?src=&lt;url-to-your.h5p&gt;</code>.</div>'; return; }

      // Load h5p-standalone from CDN (known good)
      try {
        await loadScript('https://cdn.jsdelivr.net/npm/h5p-standalone@1.3.0/dist/main.bundle.js');
        await loadScript('https://cdn.jsdelivr.net/npm/h5p-standalone@1.3.0/dist/frame.bundle.js');
      } catch(e){ app.innerHTML='<p class="err">'+e.message+'</p>'; return; }

      console.log('typeof H5PStandalone =', typeof window.H5PStandalone);
      console.log('typeof window["h5p-standalone"] =', typeof window['h5p-standalone']);

      let tries=0;
      (function waitReady(){
        tries++;
        const HS = window.H5PStandalone || window['h5p-standalone'];
        if (HS && typeof HS.display === 'function') {
          console.log('H5P detected; rendering â€¦');
          try { HS.display('#app', { h5pContent: src }); }
          catch(e){ app.innerHTML='<p class="err">Could not initialize H5P: '+(e?.message||e)+'</p>'; }
        } else if (tries < 240) { setTimeout(waitReady,50); }
        else {
          app.innerHTML='<p class="err">H5P API not ready (CDN). Check console for errors.</p>';
        }
      })();
    }
    document.addEventListener('DOMContentLoaded', boot);
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>
